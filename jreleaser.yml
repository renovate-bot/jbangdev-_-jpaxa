matrix:
  rows:
    - { goos: darwin,  goarch: amd64,  platform: osx-x86_64, ext: "" }
    - { goos: darwin,  goarch: arm64,  platform: osx-aarch_64, ext: "" }
    - { goos: linux,   goarch: amd64,  platform: linux-x86_64, ext: "" }
    - { goos: linux,   goarch: arm64,  platform: linux-aarch_64, ext: "" }
    - { goos: linux,   goarch: arm,    platform: linux-arm_32, ext: "" }
    - { goos: windows, goarch: amd64, platform: windows-x86_64, ext: ".exe" }

hooks:
  script:
    before:
      - run: |
           rm -rf build/stubs/
           rm -rf build/jpaxa/
           mkdir -p build/stubs
        filter:
          includes: ['assemble']
      - run: |
          go build -o build/stubs/stub-{{matrix.platform}} stub.go
          echo "{{matrix.goos}} {{matrix.goarch}} {{matrix.platform}}" >> build/stubs/platforms.txt
        environment:
          GOOS: "{{matrix.goos}}"
          GOARCH: "{{matrix.goarch}}"
          CGO_ENABLED: "0"
        applyDefaultMatrix: true
        filter:
          includes: ['assemble']
      - run: |
              rm -rf build/jpaxa
              mkdir -p build/jpaxa
              jbang wrapper install -d build/jpaxa
              jbang export fatjar -O build/jpaxa/jpaxa.jar --files=stubs/=build/stubs jpaxa.java
              jbang build/jpaxa/jpaxa.jar --variants all build/jpaxa -- "{{{app}}}/jbang" "{{{app}}}/jpaxa.jar"
        filter:
          includes: ['assemble']
          
project:
  name: jpaxa
  version: 999-SNAPSHOT
  description: A port of caxa to Java - a tool to package any runtime or script dependent applications into self-extracting executable binaries/bundles
  authors:
    - jbangdev
  license: MIT
  copyright: Copyright 2026 jbangdev
  links:
    homepage: https://github.com/jbangdev/jpaxa
    documentation: https://github.com/jbangdev/jpaxa#readme

release:
  github:
    owner: jbangdev
    name: jpaxa
     
distributions:
  jpaxa:
    type: FLAT_BINARY
    applyDefaultMatrix: true
    artifactPattern:
      path: 'jpaxa-output/{{distributionName}}-{{matrix.platform}}{{matrix.ext}}'




